<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Deploying django apps with nginx on koding.com">
<meta name="viewport" content="width=device-width">
<title>Nginx on koding.com | Around the world in 80 days</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://openbermuda.github.io/80days/posts/nginx-on-kodingcom.html">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    },
    displayAlign: 'center', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><meta name="author" content="Johnny Gill">
<meta property="og:site_name" content="Around the world in 80 days">
<meta property="og:title" content="Nginx on koding.com">
<meta property="og:url" content="http://openbermuda.github.io/80days/posts/nginx-on-kodingcom.html">
<meta property="og:description" content="Deploying django apps with nginx on koding.com">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-12-18T19:58:05+00:00">
</head>
<body>
    <section class="social"><ul>
<li><a href="../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://twitter.com/swfiua" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/swfiua" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">Nginx on koding.com</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2014-12-18T19:58:05+00:00">2014-12-18 19:58</time>
            
                      |  
        <a href="nginx-on-kodingcom.rst" id="sourcelink">Source</a>

            </div>
            
        </div>
        <div class="body">
            <div>
<p>It is more than time that I get the project up and running on a host
somewhere.</p>
<p>I could just check the code out on <a class="reference external" href="https//koding.com">koding.com</a> and run the project
with django's build in server, but I feel I should run it under
<em>nginx</em>.</p>
<p>I could have chosen <em>apache</em>, but I keep hearing people mention
<em>nginx</em> so I want to see what it is all about.</p>
<p>Gooling <em>nginx django koding</em> threw up a guide to deploying django
with <a class="reference external" href="http://agiliq.com/blog/2013/08/minimal-nginx-and-gunicorn-configuration-for-djang/">nginx and gunicorn</a>, so let's try that.</p>
<p>So all went well until I got to the bit about running the application
with <em>gunicorn</em>.</p>
<p>My project layout is a little different to the one in the guide.  In
particular, the <a class="reference external" href="https://cookiecutter.readthedocs.org/en/latest/">cookiecutter</a> I used to create the project lays out
the <em>django config</em> stuff a bit differently.</p>
<p>So, I did the following:</p>
<pre class="literal-block">
export DJANGO_SETTINGS_MODULE="80days.config.production"
gunicorn 80days.wsgi:application
</pre>
<p>This got me as far as being told:</p>
<pre class="literal-block">
ValueError: Couldn't setup configuration '80days.config.production.Production':
Secret value 'SECRET_KEY' is not set
</pre>
<p>Time to disappear down the SECRET_KEY rabbit hole.</p>
<p>So a little googling tells me a little about the secret key, but no
advice on how to go about keeping it secret.</p>
<p>So looking at what the wonderful <a class="reference external" href="https://github.com/pydanny/cookiecutter-django">cookiecutter django</a> created I see
the following incantation in <em>config/production.py</em>:</p>
<pre class="code python"><a name="rest_code_72b5fe0379bd462caf0a29ab6ac62e35-1"></a><span class="kn">from</span> <span class="nn">configurations</span> <span class="kn">import</span> <span class="n">values</span>
<a name="rest_code_72b5fe0379bd462caf0a29ab6ac62e35-2"></a>
<a name="rest_code_72b5fe0379bd462caf0a29ab6ac62e35-3"></a><span class="c"># SECRET KEY</span>
<a name="rest_code_72b5fe0379bd462caf0a29ab6ac62e35-4"></a><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">SecretValue</span><span class="p">()</span>
<a name="rest_code_72b5fe0379bd462caf0a29ab6ac62e35-5"></a><span class="c"># END SECRET KEY</span>
</pre>
<p>So what is this <em>configuration.values</em> thing?   Turns out it is coming
from the <a class="reference external" href="http://django-configurations.readthedocs.org/">django configurations</a> application that the <a class="reference external" href="https://cookiecutter.readthedocs.org/en/latest/">cookiecutter</a>
was kind enough to include.</p>
<p>OK, so it helps you not have to do</p>
<pre class="code python"><a name="rest_code_5297ada5437f4b34b8a91dd07060c31c-1"></a><span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="o">*</span>
</pre>
<p>Now, that has to be a good thing :)</p>
<p>So reading the docs I come to:</p>
<pre class="literal-block">
django-configurations allows you to optionally reduce the amount
of validation and setup code in your settings.py by using Value
classes. They have the ability to handle values from the process
environment of your software (os.environ) and work well in
projects that follow the Twelve-Factor methodology.
</pre>
<p>I will leave this <a class="reference external" href="http://12factor.net/">twelve factor</a> thing for another day, but a quick
glance suggests there are some good guidelines there.</p>
<p>So, digging into the docs for django configurations (which, by the way
are quite excellent).  I come to <a class="reference external" href="http://django-configurations.readthedocs.org/en/latest/values/">this little gem</a>.  In short, this
magic <em>values.SecretValue()</em> is there to discourage me from actually
putting my secret key in the config file.</p>
<p>This is good, because I am pretty sure I have committed this sin in
pretty much every django project I have done up to now.  Thank you
<a class="reference external" href="https://cookiecutter.readthedocs.org/en/latest/">cookiecutter</a> :)</p>
<p>Having said that, I feel this another case where good intentions are
likely to result in bad security, for more see my <a class="reference external" href="rant-about-computer-insecurity.html">rant about computer
(in)security</a></p>
<p>With a tight deadline, how many developers would just slap a value in
the config file <em>just to get things working</em> and be done with it?</p>
<div class="section" id="now-what-was-i-doing">
<h2>Now what was I doing?</h2>
<p>OK, back to getting my site up and running.</p>
<p>So armed with this new information I am back to trying to run
gunicorn.</p>
<p>Lots of errors from the production config, so I comment out a couple
of sections.  At this point I am not planning on using Amazon's AWS,
so that can all be commented out.</p>
<p>Also, I am sure I will need this <em>sendgrid</em> thing just yet, so that is
getting commented out too.</p>
<p>Nearly there (I think), but gunicorn is still failing due <em>s3boto.py</em>
being unable to import <em>StringIO</em>.  Now this looks like a python3
problem, since in python 3, StringIO got moved to io.StringIO :(</p>
<p>OK, so boto is an interface to AWS. I am not using that, so this one
is easy to fix.</p>
<p>And finally, <em>gunicorn</em> is running.</p>
<p>Chrome is doing something weird, it is switching to https and then
hanging with a mysterious <em>establishing secure connection</em> message.
However, firefox and even chrome from another machine are just fine.</p>
<p>So that's all for today, will finish this off tomorrow.</p>
<!-- title: links -->
<!-- slug: references -->
<!-- date: 2014-11-13 14:08:31 UTC -->
<!-- tags: -->
<!-- link: -->
<!-- description: links to include in all posts -->
<!-- type: text -->
</div>
</div>
        </div>
                <ul class="pager">
<li class="previous">
                <a href="rant-about-computer-insecurity.html" rel="prev" title="Rant about computer (in)security">Previous post</a>
            </li>
            <li class="next">
                <a href="the-music-from-uncle.html" rel="next" title="The Music from UNCLE">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="eightydays",
            disqus_url="http://openbermuda.github.io/80days/posts/nginx-on-kodingcom.html",
        disqus_title="Nginx on koding.com",
        disqus_identifier="cache/posts/nginx-on-kodingcom.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
                    <footer id="footer" role="contentinfo"><p>Contents © 2015         <a href="mailto:swfiua@gmail.com">Johnny Gill</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
            
        </footer>
</div>
    </section><script src="../assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
